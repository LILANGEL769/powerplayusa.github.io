<!DOCTYPE html>
<html>
<head>
    <title>{{ state.name }} Information</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
<script>
    function setCookie(name, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function joinPrimary(form) {
        // Retrieve the form data
        var position = form.getAttribute('data-position');
        var party = form.party.value;
        var candidate = form.getAttribute('data-candidate');

        // Check if already running for any position
        var runningCookies = document.cookie.split(';');
        for (var i = 0; i < runningCookies.length; i++) {
            var c = runningCookies[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            var cookiePosition = c.split('=')[0];
            if (cookiePosition !== position && cookiePosition !== "") {
                alert("You are already running for another position!");
                return false;
            }
        }

        // Check if already running for this position
        var runningCookie = getCookie(position);
        if (runningCookie) {
            alert("You are already running for this position!");
            return false;
        }

        // Update the page dynamically
        var positionElement = document.querySelector('[data-position="' + position + '"]');
        positionElement.innerHTML = positionElement.innerHTML + ' - ' + candidate + ' (' + party + ')';

        // Set the running status in a cookie
        setCookie(position, 'running', 365);

        // Reset the form
        form.reset();

        // Prevent the form from submitting and reloading the page
        return false;
    }

    function withdrawPrimary(position) {
        // Remove the running status from the cookie
        setCookie(position, '', -1);

        // Update the page dynamically
        var positionElement = document.querySelector('[data-position="' + position + '"]');
        positionElement.innerHTML = position;

        // Show a success message
        alert("You have successfully withdrawn from the primary.");

        // Prevent the default link behavior
        return false;
    }
</script>
</head>
<body>
    <h1>{{ state.name }} Information</h1>

    <h2>Population: {{ state.population }}</h2>
    <h2>Social Stance: {{ state.social_stance }}</h2>
    <h2>Economic Stance: {{ state.economic_stance }}</h2>
    <h2>Governor Salary: {{ state.governor_salary }}</h2>
    <h2>Senator Salary: {{ state.senator_salary }}</h2>
    <h2>Lt. Governor Salary: {{ state.lt_governor_salary }}</h2>
    <h2>Representative Salary: {{ state.representative_salary }}</h2>
    <h2>Ranked Choice Voting: {{ state.ranked_choice_voting }}</h2>
    <h2>Term Limit: {{ state.term_limit }}</h2>

    <h2>Governor: {{ state.governor.username }}</h2>
    <h2>Lt. Governor: {{ state.lt_governor.username }}</h2>
    <h2>Senators:</h2>
    <ul>
        <li>{{ state.senator1.username }} (Class {{ state.senator1.senate_class }})</li>
        <li>{{ state.senator2.username }} (Class {{ state.senator2.senate_class }})</li>
    </ul>
    <h2>Representatives: {{ state.representative.seat_count }}</h2>
    <ul>
        <li>{{ state.representative.username }}</li>
    </ul>

    {% if politician %}
        <p>Welcome, {{ politician.name }}!</p>

        <!-- Primary Election Form for Governor -->
        {% if politician.party == 'Democratic' or politician.party == 'Republican' %}
            <form data-position="Governor" data-candidate="{{ politician.name }}" onsubmit="return joinPrimary(this)">
                <h4>Governor:</h4>
                <select name="party">
                    <option value="{{ politician.party }}" selected>{{ politician.party }}</option>
                </select>
                <input type="submit" value="Join Primary">
            </form>
            {% if getCookie('Governor') %}
                <button onclick="return withdrawPrimary('Governor')">Withdraw Primary</button>
            {% endif %}
        {% endif %}

        <!-- Primary Election Form for Senate Class 1 -->
        {% if politician.party == 'Democratic' or politician.party == 'Republican' %}
            <form data-position="Senate Class 1" data-candidate="{{ politician.name }}" onsubmit="return joinPrimary(this)">
                <h4>Senate Class 1:</h4>
                <select name="party">
                    <option value="{{ politician.party }}" selected>{{ politician.party }}</option>
                </select>
                <input type="submit" value="Join Primary">
            </form>
            {% if getCookie('Senate Class 1') %}
                <button onclick="return withdrawPrimary('Senate Class 1')">Withdraw Primary</button>
            {% endif %}
        {% endif %}

        <!-- Primary Election Form for Senate Class 2 -->
        {% if politician.party == 'Democratic' or politician.party == 'Republican' %}
            <form data-position="Senate Class 2" data-candidate="{{ politician.name }}" onsubmit="return joinPrimary(this)">
                <h4>Senate Class 2:</h4>
                <select name="party">
                    <option value="{{ politician.party }}" selected>{{ politician.party }}</option>
                </select>
                <input type="submit" value="Join Primary">
            </form>
            {% if getCookie('Senate Class 2') %}
                <button onclick="return withdrawPrimary('Senate Class 2')">Withdraw Primary</button>
            {% endif %}
        {% endif %}

        <!-- Primary Election Form for Representative -->
        {% if politician.party == 'Democratic' or politician.party == 'Republican' %}
            <form data-position="Representative" data-candidate="{{ politician.name }}" onsubmit="return joinPrimary(this)">
                <h4>Representative:</h4>
                <select name="party">
                    <option value="{{ politician.party }}" selected>{{ politician.party }}</option>
                </select>
                <input type="submit" value="Join Primary">
            </form>
            {% if getCookie('Representative') %}
                <button onclick="return withdrawPrimary('Representative')">Withdraw Primary</button>
            {% endif %}
        {% endif %}
    {% else %}
        <p>Please log in to participate in the primary elections.</p>
    {% endif %}
</body>
</html>
